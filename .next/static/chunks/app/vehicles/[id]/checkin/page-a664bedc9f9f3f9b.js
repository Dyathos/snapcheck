(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[946],{9269:function(e,t,s){Promise.resolve().then(s.bind(s,318)),Promise.resolve().then(s.bind(s,4104))},318:function(e,t,s){"use strict";s.r(t),s.d(t,{CheckInForm:function(){return d}});var r=s(7437),n=s(2265),l=s(4033),i=s(3192),a=s(6806);function c(e){let{items:t,onItemSelect:s,selectedItems:l}=e,[c,d]=(0,n.useState)(null),o=Array.from(new Set(t.map(e=>e.category))),u=c?t.filter(e=>e.category===c):t,m=e=>{switch(e){case"warning":return"bg-yellow-100 text-yellow-800";case"critical":return"bg-red-100 text-red-800";default:return"bg-green-100 text-green-800"}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(a.z,{variant:null===c?"default":"outline",onClick:()=>d(null),className:"text-sm",children:"Tous"}),o.map(e=>(0,r.jsx)(a.z,{variant:c===e?"default":"outline",onClick:()=>d(e),className:"text-sm",children:e},e))]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(e=>(0,r.jsx)("button",{onClick:()=>s(e),className:"flex items-center p-4 rounded-lg border transition-colors ".concat(l.includes(e.id)?"border-red-500 bg-red-50":"border-gray-200 hover:border-blue-500"),children:(0,r.jsxs)("div",{className:"flex-1 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-lg",children:e.icon}),(0,r.jsx)("h3",{className:"font-medium",children:e.name})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.description}),e.status&&(0,r.jsxs)(i.C,{className:"mt-2 ".concat(m(e.status)),children:[e.status,e.severity&&" - ".concat(e.severity)]})]})},e.id))})]})}function d(e){let{vehicleId:t,items:s}=e,i=(0,l.useRouter)(),[d,o]=(0,n.useState)(1),[u,m]=(0,n.useState)([]),[x,h]=(0,n.useState)({}),[f,v]=(0,n.useState)(!1),g=e=>{m(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])},b=(e,t)=>{h(s=>({...s,[e]:{...s[e],severity:t}}))},j=(e,t)=>{h(s=>({...s,[e]:{...s[e],description:t}}))},p=async()=>{try{v(!0);let e=s.map(e=>{var t,s;return{itemId:e.id,status:u.includes(e.id)?"warning":"ok",severity:u.includes(e.id)?(null===(t=x[e.id])||void 0===t?void 0:t.severity)||"low":null,description:u.includes(e.id)?(null===(s=x[e.id])||void 0===s?void 0:s.description)||"":null}}),r=await fetch("/api/vehicles/".concat(t,"/checkin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:e})});if(!r.ok)throw Error("Erreur lors de la mise \xe0 jour");i.refresh(),i.push("/vehicles/".concat(t))}catch(e){console.error("Error updating check-in:",e),alert("Une erreur est survenue lors de la mise \xe0 jour")}finally{v(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat(d>=1?"bg-blue-600 text-white":"bg-gray-200"),children:"1"}),(0,r.jsx)("div",{className:"w-16 h-1 bg-gray-200",children:(0,r.jsx)("div",{className:"h-full ".concat(d>=2?"bg-blue-600":"bg-gray-200")})}),(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat(d>=2?"bg-blue-600 text-white":"bg-gray-200"),children:"2"}),(0,r.jsx)("div",{className:"w-16 h-1 bg-gray-200",children:(0,r.jsx)("div",{className:"h-full ".concat(d>=3?"bg-blue-600":"bg-gray-200")})}),(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat(d>=3?"bg-blue-600 text-white":"bg-gray-200"),children:"3"})]})}),(()=>{switch(d){case 1:return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-blue-700",children:"S\xe9lectionnez les \xe9l\xe9ments pr\xe9sentant un probl\xe8me. Les \xe9l\xe9ments non s\xe9lectionn\xe9s seront consid\xe9r\xe9s comme \xe9tant en bon \xe9tat."})}),(0,r.jsx)(c,{items:s,onItemSelect:g,selectedItems:u}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(a.z,{onClick:()=>o(2),disabled:0===u.length,children:"Continuer"})})]});case 2:return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:"Pr\xe9cisez la gravit\xe9 et ajoutez une description pour chaque \xe9l\xe9ment s\xe9lectionn\xe9."})}),(0,r.jsx)("div",{className:"space-y-4",children:u.map(e=>{var t,n;let l=s.find(t=>t.id===e);return l?(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-lg",children:l.icon}),(0,r.jsx)("h3",{className:"font-medium",children:l.name})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Gravit\xe9"}),(0,r.jsxs)("select",{value:(null===(t=x[e])||void 0===t?void 0:t.severity)||"low",onChange:t=>b(e,t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,r.jsx)("option",{value:"low",children:"Faible"}),(0,r.jsx)("option",{value:"medium",children:"Moyenne"}),(0,r.jsx)("option",{value:"high",children:"Haute"}),(0,r.jsx)("option",{value:"critical",children:"Critique"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,r.jsx)("textarea",{value:(null===(n=x[e])||void 0===n?void 0:n.description)||"",onChange:t=>j(e,t.target.value),rows:2,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]})]},e):null})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(a.z,{variant:"outline",onClick:()=>o(1),children:"Retour"}),(0,r.jsx)(a.z,{onClick:()=>o(3),children:"Continuer"})]})]});case 3:return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-green-700",children:"V\xe9rifiez le r\xe9capitulatif des probl\xe8mes avant de valider."})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"font-medium text-lg",children:"\xc9l\xe9ments avec probl\xe8mes"}),(0,r.jsx)("div",{className:"space-y-4",children:u.map(e=>{var t,n;let l=s.find(t=>t.id===e);return l?(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-lg",children:l.icon}),(0,r.jsx)("h4",{className:"font-medium",children:l.name})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Gravit\xe9: ",(null===(t=x[e])||void 0===t?void 0:t.severity)||"faible"]})]}),(null===(n=x[e])||void 0===n?void 0:n.description)&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:x[e].description})]},e):null})}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h3",{className:"font-medium text-lg",children:"\xc9l\xe9ments en bon \xe9tat"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:[s.length-u.length," \xe9l\xe9ments sont en bon \xe9tat."]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(a.z,{variant:"outline",onClick:()=>o(2),children:"Retour"}),(0,r.jsx)(a.z,{onClick:p,disabled:f,children:f?"Enregistrement...":"Valider"})]})]});default:return null}})()]})}},4104:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var r=s(7437),n=s(13),l=s(4033);function i(e){let{title:t,showBack:s=!1,action:i,description:a}=e,c=(0,l.useRouter)();return(0,r.jsx)("header",{className:"sticky top-0 z-50 bg-white border-b border-gray-200",children:(0,r.jsxs)("div",{className:"px-4 h-14 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[s&&(0,r.jsx)("button",{onClick:()=>c.back(),className:"p-1 -ml-1 rounded-full hover:bg-gray-50",children:(0,r.jsx)(n.Z,{className:"h-6 w-6"})}),(0,r.jsx)("h1",{className:"text-lg font-semibold",children:t})]}),i&&(0,r.jsx)("div",{children:i})]})})}},3192:function(e,t,s){"use strict";s.d(t,{C:function(){return c}});var r=s(7437),n=s(2265),l=s(6061),i=s(345);let a=(0,l.j)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/80",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"bg-green-500 text-white hover:bg-green-400",warning:"bg-yellow-500 text-black hover:bg-yellow-400"}},defaultVariants:{variant:"default"}}),c=(0,n.forwardRef)((e,t)=>{let{className:s,variant:n,children:l,...c}=e;return(0,r.jsx)("div",{className:(0,i.cn)(a({variant:n}),s),ref:t,...c,children:l})});c.displayName="Badge"},6806:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var r=s(7437),n=s(2265),l=s(6061),i=s(345);let a=(0,l.j)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=(0,n.forwardRef)((e,t)=>{let{className:s,variant:n,size:l,...c}=e;return(0,r.jsx)("button",{className:(0,i.cn)(a({variant:n,size:l}),s),ref:t,...c})});c.displayName="Button"},345:function(e,t,s){"use strict";s.d(t,{cn:function(){return l},iV:function(){return a},p6:function(){return i}});var r=s(7042),n=s(4769);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}function i(e){return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}function a(e){switch(e.toLowerCase()){case"critical":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";case"good":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}},13:function(e,t,s){"use strict";var r=s(2265);let n=r.forwardRef(function({title:e,titleId:t,...s},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))});t.Z=n},6061:function(e,t,s){"use strict";s.d(t,{j:function(){return i}});var r=s(7042);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=r.W,i=(e,t)=>s=>{var r;if((null==t?void 0:t.variants)==null)return l(e,null==s?void 0:s.class,null==s?void 0:s.className);let{variants:i,defaultVariants:a}=t,c=Object.keys(i).map(e=>{let t=null==s?void 0:s[e],r=null==a?void 0:a[e];if(null===t)return null;let l=n(t)||n(r);return i[e][l]}),d=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{}),o=null==t?void 0:null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...n}=t;return Object.entries(n).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...a,...d}[t]):({...a,...d})[t]===s})?[...e,s,r]:e},[]);return l(e,c,o,null==s?void 0:s.class,null==s?void 0:s.className)}}},function(e){e.O(0,[991,971,472,744],function(){return e(e.s=9269)}),_N_E=e.O()}]);